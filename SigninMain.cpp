/***************************************************************
* Name:      SigninMain.h
* Purpose:   App's main frame with GUI.
* Author:    sunzhenbao (suzhenbao@live.com)
* Copyright: sunzhenbao ()
* License:
**************************************************************/

#ifndef __SigninMain__
#define __SigninMain__

/**
@file
Subclass of SigninFrame, which is generated by wxFormBuilder.
*/

#include "SigninFrame.h"
//// end generated include
#include <wx/progdlg.h>
#include "./camera/CameraView.h"
#include "./certcard/CertCard.h"
#include "./certcard/CertCardListener.h"

class ProgressThread;
/** Implementing SigninFrame */
class SigninMain : public SigninFrame, public ICertCardListener
{
	protected:
		std::mutex m_mtxProgress;
		CameraView* m_CameraView;
		CertCard* m_CertCard;

		// Handlers for SigninFrame events.
		void OnClose( wxCloseEvent& event );
public:
		/** Constructor */
		SigninMain( wxWindow* parent );
	//// end generated class members


public:
		~SigninMain();
		bool Cancelled();
		bool m_cancelled;
		wxCriticalSection m_csCancelled;        // protects m_cancelled

		wxProgressDialog* m_dlgProgress;
		ProgressThread *m_threadProgress;

		void OnWorkerEvent(wxThreadEvent& event);
		void OnUpdateWorker(wxUpdateUIEvent& event);

		void UpdateCardAuthed(bool authed, const std::string& info);
		void UpdateCertCardInfo(const std::shared_ptr<CertCardInfo>& info);
		void StartProcess(const std::string& info);
		void EndProcess(int result, const std::string& info);
		void UpdateProgressInfo(int progress, const std::string& info);
		CameraView* GetCameraView();
};

#endif // __SigninMain__
